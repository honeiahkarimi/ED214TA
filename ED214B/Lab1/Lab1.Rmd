---
title: "Lab 1"
author: "ED 214B"
date: "Winter 2024"
output: 
  prettydoc::html_pretty:
    theme: architect
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, out.width="80%", fig.align='center')
```

## Working Directory

```{r}
setwd("~/Desktop/ED214_TA_Materials/ED214B/Lab1")
```

## Libraries

```{r}
library(readr) # importing csv file
library(psych) # describe function
library(tidyverse) # ggplot and piping operator
```

## Import Data

```{r}
MA_Schools <- read_csv("MA_Schools.csv")
MA_Schools
```

## Data Cleaning

```{r}
df <- MA_Schools %>%
  select(-X1) # deleting extra column X1
View(df)
```

<b>Is there a relationship between money allocated for schools and student performance?</b>

**Null hypothesis**

- $H_0$: There is no relationship between money spent and student performance
- $H_0$: $\rho$ = 0
- $H_0$: $\beta_1$ = 0

**Alternative hypothesis**

- $H_a$: There *is* a relationship between money spent and student performance 
- $H_a$: $\rho \neq$ 0
- $H_a$: $\beta_1 \neq$ 0

## Inspect Variables

- Predictor: exptot (Expenditures per pupil, total)
- Outcome: score8 (8th grade score (math + English + science))
 
## Check the descriptives

```{r}
describe(df$exptot) # from psych
describe(df$score8)
```

## Graph the univariate statistics

```{r}
df %>% 
  ggplot(aes(x=exptot))+
  geom_histogram()+
  theme_classic()

df %>% 
  ggplot(aes(x=score8))+
  geom_histogram()+
  theme_classic()
```

## Recode Missing Data

```{r}
df$score8[df$score8==-999] <- NA

sum(is.na(df$score8))
```

## Check Descriptives Again

```{r}
describe(df$score8)

df %>% 
  ggplot(aes(x=score8))+
  geom_histogram()+
  theme_minimal()
```

## Plot the Relationship

```{r}
df %>% 
  ggplot(aes(x=exptot,y=score8))+
  geom_point()+
  theme_minimal()+
  geom_smooth(method="lm",se=FALSE)
```

## Correlation

```{r}
cor.test(df$exptot,df$score8)
```

## Simple Linear Regression

```{r}
model <- lm(df$score8~df$exptot)
summary(model)
```

$$\hat{y} = \beta_0 + \beta_1*x_1$$

$$\hat{y} = 675.4 + .004218*x_1$$

A one unit increase in Expenditures per pupil is associated with a .0042 unit increase in 8th grader test scores.

$R^2$ (coefficient of determination) tells us how much the variance our model can account for. This model can account for 4% of the variance.

## Plot relationship between residuals and look at residuals

- Residuals vs Fitted: we want to see no relationship and a horizontal red line
- QQ plot: we want to see a straight line
- Scale-Location: we want to see no relationship, and a horizontal red line
- Residuals vs Leverage: used to see which residuals are influencing the regression line 

```{r}
plot(model)
```

## Outliers and noteworthy residuals 

- Let's look at rows 208, 22, and 34. Try practicing with row 97 on your own.

- #, = select this row

```{r}
df[22,]
df[208,]
df[34,]
```

- Compare them to the mean, min, and max of each variable

```{r}
mean(df$exptot)
min(df$exptot)
max(df$exptot)
mean(df$score8,na.rm=T)
min(df$score8,na.rm=T)
max(df$score8,na.rm=T)
```

- District 22: Had a pretty low score with an above average amount of money spent per student
- District 208: Had a high score with an above average amount of money spent per student
- District 34: Had the highest amount of money spent, and their score was below average per student

